<% content_for :title, "Settings" %>

<div class="max-w-6xl mx-auto">
  <% if notice.present? %>
    <div class="mb-6 py-3 px-4 bg-green-500/10 border border-green-500/20 text-green-400 rounded-lg">
      <%= notice %>
    </div>
  <% end %>

  <div class="mb-8">
    <h1 class="text-2xl font-bold text-white mb-2">Settings</h1>
    <p class="text-slate-400">Manage homepage content and integrations.</p>
  </div>

  <!-- Homepage Settings Form -->
  <%= form_with url: batch_update_admin_settings_path, method: :patch, class: "space-y-6 mb-8" do |f| %>
    
    <!-- Header Section -->
    <div class="bg-surface-dark rounded-xl border border-slate-700/50 overflow-hidden">
      <div class="p-6 border-b border-slate-700/50">
        <h2 class="text-lg font-bold text-white flex items-center gap-2">
          <span class="material-symbols-outlined text-primary">web</span>
          Header
        </h2>
      </div>
      <div class="p-6 space-y-4">
        <% @header_settings.each do |setting| %>
          <div>
            <%= label_tag "settings[#{setting.key}]", setting.key.humanize.titleize, class: "block text-sm font-medium text-slate-300 mb-2" %>
            <%= text_field_tag "settings[#{setting.key}]", setting.value, class: "w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary", placeholder: setting.key %>
            <% if setting.key == 'site_logo_url' %>
              <p class="text-xs text-slate-500 mt-1">Enter a URL for your logo image</p>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Hero Section -->
    <div class="bg-surface-dark rounded-xl border border-slate-700/50 overflow-hidden">
      <div class="p-6 border-b border-slate-700/50">
        <h2 class="text-lg font-bold text-white flex items-center gap-2">
          <span class="material-symbols-outlined text-primary">rocket_launch</span>
          Hero Section
        </h2>
      </div>
      <div class="p-6 space-y-4">
        <% @hero_settings.each do |setting| %>
          <div>
            <%= label_tag "settings[#{setting.key}]", setting.key.humanize.titleize, class: "block text-sm font-medium text-slate-300 mb-2" %>
            <% if setting.key.include?('subtitle') %>
              <%= text_area_tag "settings[#{setting.key}]", setting.value, rows: 3, class: "w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary" %>
            <% else %>
              <%= text_field_tag "settings[#{setting.key}]", setting.value, class: "w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Footer CTA Section -->
    <div class="bg-surface-dark rounded-xl border border-slate-700/50 overflow-hidden">
      <div class="p-6 border-b border-slate-700/50">
        <h2 class="text-lg font-bold text-white flex items-center gap-2">
          <span class="material-symbols-outlined text-primary">call_to_action</span>
          Footer CTA
        </h2>
      </div>
      <div class="p-6 space-y-4">
        <% @footer_settings.each do |setting| %>
          <div>
            <%= label_tag "settings[#{setting.key}]", setting.key.humanize.titleize, class: "block text-sm font-medium text-slate-300 mb-2" %>
            <% if setting.key.include?('subtitle') %>
              <%= text_area_tag "settings[#{setting.key}]", setting.value, rows: 2, class: "w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary" %>
            <% else %>
              <%= text_field_tag "settings[#{setting.key}]", setting.value, class: "w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- General Settings -->
    <% if @general_settings.any? %>
      <div class="bg-surface-dark rounded-xl border border-slate-700/50 overflow-hidden">
        <div class="p-6 border-b border-slate-700/50">
          <h2 class="text-lg font-bold text-white flex items-center gap-2">
            <span class="material-symbols-outlined text-primary">settings</span>
            General
          </h2>
        </div>
        <div class="p-6 space-y-4">
          <% @general_settings.each do |setting| %>
            <div>
              <%= label_tag "settings[#{setting.key}]", setting.key.humanize.titleize, class: "block text-sm font-medium text-slate-300 mb-2" %>
              <%= text_field_tag "settings[#{setting.key}]", setting.value, class: "w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Submit Button -->
    <div class="flex justify-end">
      <%= f.submit "Save All Settings", class: "px-6 py-3 bg-primary hover:bg-blue-600 text-white font-bold rounded-lg transition-colors cursor-pointer" %>
    </div>
  <% end %>

  <!-- Integrations Card -->
  <div class="bg-surface-dark rounded-xl border border-slate-700/50 overflow-hidden">
    <div class="p-6 border-b border-slate-700/50">
      <h2 class="text-lg font-bold text-white flex items-center gap-2">
        <span class="material-symbols-outlined text-primary">extension</span>
        Integrations
      </h2>
    </div>

    <div class="divide-y divide-slate-700/50">
      <!-- Meta / Facebook Lead Ads -->
      <div class="p-6 flex items-start justify-between">
        <div class="flex gap-4">
          <div class="w-12 h-12 rounded-lg bg-[#1877F2]/10 flex items-center justify-center text-[#1877F2]">
            <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          </div>
          <div>
            <h3 class="text-white font-medium text-base">Facebook Lead Ads</h3>
            <p class="text-slate-400 text-sm mt-1">Sync leads and creatives automatically.</p>

            <% if @meta_connection %>
              <div class="mt-3 flex items-center gap-2">
                <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                  <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                  Connected: <%= @meta_connection.page_name %>
                </span>
              </div>
            <% end %>
          </div>
        </div>

        <div>
          <% if @meta_connection %>
            <%= button_to disconnect_meta_admin_settings_path, method: :delete, class: "px-4 py-2 text-sm font-medium text-red-400 hover:bg-red-900/20 rounded-lg transition-colors border border-transparent hover:border-red-900/30" do %>
              Disconnect
            <% end %>
          <% else %>
            <%
              app_id = Rails.application.credentials.dig(:meta, :app_id)
              redirect_uri = auth_meta_callback_url
              scope = "leads_retrieval,pages_manage_metadata,pages_read_engagement,ads_management,pages_show_list,business_management"
              oauth_url = "https://www.facebook.com/v19.0/dialog/oauth?client_id=#{app_id}&redirect_uri=#{redirect_uri}&scope=#{scope}&response_type=code"
            %>
            <a href="<%= oauth_url %>" class="flex items-center gap-2 px-4 py-2 bg-[#1877F2] hover:bg-[#1877F2]/90 text-white text-sm font-bold rounded-lg transition-colors shadow-lg shadow-blue-900/20">
              Connect Page
            </a>
          <% end %>
        </div>
      </div>

      <!-- Chatwoot -->
      <div class="p-6 flex items-start justify-between bg-slate-800/30">
        <div class="flex gap-4">
          <div class="w-12 h-12 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400">
            <span class="material-symbols-outlined text-2xl">chat</span>
          </div>
          <div>
            <h3 class="text-white font-medium text-base">Chatwoot</h3>
            <p class="text-slate-400 text-sm mt-1">Connected CRM for conversations.</p>
             <div class="mt-3 flex items-center gap-2">
                <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                  <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                  Active
                </span>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
