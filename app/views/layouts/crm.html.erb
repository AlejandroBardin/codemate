<!DOCTYPE html>
<html class="dark" lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Terral CRM</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>

  <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>

  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#3b82f6",
            "background-light": "#f8fafc",
            "background-dark": "#0f172a",
            "sidebar-dark": "#1e293b",
          },
          fontFamily: {
            sans: ["Inter", "sans-serif"],
            display: ["Inter", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "12px",
          },
        },
      },
    };
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    .active-nav {
      background-color: rgba(59, 130, 246, 0.1);
      border-left: 3px solid #3b82f6;
      color: #3b82f6;
    }
    body {
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen">

  <!-- Sidebar -->
  <div class="fixed inset-y-0 left-0 w-64 bg-white dark:bg-sidebar-dark z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out border-r border-slate-200 dark:border-slate-700" id="sidebar">
    <div class="flex flex-col h-full">
      <div class="p-6">
        <h1 class="text-2xl font-bold tracking-tighter text-slate-900 dark:text-white uppercase">Terral</h1>
      </div>
      <nav class="flex-1 px-3 space-y-1">
        <%= link_to admin_dashboard_path, class: "flex items-center px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-colors" do %>
          <span class="material-symbols-outlined mr-3">home</span>
          <span class="font-medium">Dashboard</span>
        <% end %>

        <%= link_to admin_leads_path, class: "flex items-center px-4 py-3 #{current_page?(admin_leads_path) ? 'active-nav' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50'} rounded-lg transition-colors" do %>
          <span class="material-symbols-outlined mr-3" style="font-variation-settings: 'FILL' 1">group</span>
          <span class="font-medium">CRM Leads</span>
        <% end %>

        <%= link_to admin_packages_path, class: "flex items-center px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-colors" do %>
          <span class="material-symbols-outlined mr-3">inventory_2</span>
          <span class="font-medium">Paquetes</span>
        <% end %>

        <%= link_to admin_pixel_path, class: "flex items-center px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-colors" do %>
          <span class="material-symbols-outlined mr-3">analytics</span>
          <span class="font-medium">Pixel Analytics</span>
        <% end %>

        <%= link_to admin_settings_path, class: "flex items-center px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-colors" do %>
          <span class="material-symbols-outlined mr-3">settings</span>
          <span class="font-medium">Configuraci√≥n</span>
        <% end %>

        <div class="pt-6 pb-2 px-4 text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider">
          Integraciones
        </div>

        <a class="flex items-center px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-colors" href="#">
          <span class="material-symbols-outlined mr-3">chat</span>
          <span class="font-medium">Chatwoot</span>
        </a>
      </nav>

      <!-- User Profile -->
      <div class="p-4 border-t border-slate-200 dark:border-slate-700">
        <div class="flex items-center p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
          <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold">AR</div>
          <div class="ml-3 overflow-hidden">
            <p class="text-sm font-semibold truncate text-slate-900 dark:text-white">Admin User</p>
            <p class="text-xs text-slate-500 dark:text-slate-400 truncate">Admin</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay -->
  <div class="fixed inset-0 bg-black/50 z-40 hidden opacity-0 transition-opacity duration-300 lg:hidden" id="sidebar-overlay"></div>

  <!-- Main Content -->
  <div class="flex flex-col min-h-screen lg:pl-64 transition-all duration-300">
    <header class="sticky top-0 z-30 bg-white/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button class="p-2 -ml-2 text-slate-600 dark:text-slate-400 lg:hidden" id="menu-toggle">
          <span class="material-symbols-outlined">menu</span>
        </button>
        <h2 class="text-lg font-bold text-slate-900 dark:text-white">CRM Leads</h2>
      </div>
      <div class="flex items-center gap-2">
        <button class="p-2 text-slate-600 dark:text-slate-400">
          <span class="material-symbols-outlined text-[22px]">search</span>
        </button>
        <button class="p-2 text-slate-600 dark:text-slate-400 relative">
          <span class="material-symbols-outlined text-[22px]">notifications</span>
          <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-background-dark"></span>
        </button>
      </div>
    </header>

    <main class="flex-1 p-4 pb-24 relative" data-controller="drawer">
       <%= yield %>

        <!-- Drawer Container -->
        <div class="fixed inset-0 overflow-hidden z-[100] pointer-events-none" aria-labelledby="slide-over-title" role="dialog" aria-modal="true">
            <div class="absolute inset-0 overflow-hidden">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity opacity-0 pointer-events-auto"
                data-drawer-target="backdrop"
                data-action="click->drawer#close"
                aria-hidden="true"></div>

            <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10">
                <!-- Panel -->
                <div class="pointer-events-auto relative w-screen max-w-md transform transition ease-in-out duration-500 translate-x-full sm:duration-700"
                    data-drawer-target="panel">

                <div class="flex h-full flex-col overflow-y-scroll bg-gray-900 shadow-2xl border-l border-gray-800"
                    data-drawer-target="content">
                    <!-- Content loaded via Fetch -->
                </div>
                </div>
            </div>
            </div>
        </div>
    </main>
  </div>

  <script>
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    function toggleMenu() {
      const isMobile = window.innerWidth < 1024;
      if (!isMobile) return;

      const isOpen = !sidebar.classList.contains('-translate-x-full');
      if (isOpen) {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
        overlay.classList.remove('opacity-100');
      } else {
        sidebar.classList.remove('-translate-x-full');
        overlay.classList.remove('hidden');
        setTimeout(() => overlay.classList.add('opacity-100'), 10);
      }
    }

    if(menuToggle) {
        menuToggle.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);
    }
  </script>
</body>
</html>
